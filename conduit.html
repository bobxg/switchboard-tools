<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="icon.png" />
  <title>Conduit Sizer - Switchboard Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <img src="icon.png" class="topleft-icon" alt="App Icon" />
  <div class="top-tabs">
    <a class="tab" href="index.html">Home</a>
    <a class="tab" href="switchboard.html">Switchboard Sizer</a>
    <a class="tab" href="switchroom.html">Switchroom Sizer</a>
    <a class="tab" href="lightingsearch.html">Lighting Search</a>
    <div class="tab has-dropdown active">
      <span>TBC</span>
      <div class="dropdown-content">
        <a href="conduit.html">Conduit Sizer</a>
        <a href="cablesizing.html">Cable Sizing</a>
        <a href="cableweight.html">Cable Weight</a>
        <a href="pvsizing.html">PV Sizing</a>
        <a href="emergencylighting.html">Emergency Lighting</a>
        <a href="inspection.html">Site Inspection</a>
        <a href="sld.html">Single Line Diagram</a>
        <a href="as3000tips.html">AS3000 Tips</a>
        <a href="maxdemand.html">Maximum Demand</a>
      </div>
    </div>
    <a class="tab" href="qa.html">Verification</a>
  </div>
  <div class="main-content">
    <h1>Conduit Sizer (AS/NZS 3000)</h1>
    <p>
      Enter the number of each cable size to calculate the smallest conduit size required.<br>
      <span style="color:#1976d2; font-size:0.95em;">
        (Fill factors per AS/NZS 3000 Appendix C: 1 cable = 50%, 2 cables = 33%, 3+ cables = 40%)
      </span>
    </p>
    <div style="margin-bottom: 20px; text-align: center;">
      <label for="cableTypeSelect" style="font-weight: bold; margin-right: 10px;">Cable Type:</label>
      <select id="cableTypeSelect" style="padding: 5px;">
        <option value="single">Single Core (Thermoplastic)</option>
        <option value="multicore">Multicore Circular (PVC/PVC)</option>
      </select>
    </div>
    <form id="cableForm" autocomplete="off">
      <table style="margin:0 auto 20px auto; border-collapse:collapse; width:100%; max-width:350px; background:#fff; box-shadow:0 2px 8px #eee;">
        <thead>
          <tr>
            <th>Cable Area (mmÂ²)</th>
            <th>Number of Cables</th>
          </tr>
        </thead>
        <tbody id="cableTableBody"></tbody>
      </table>
      <div class="conduit-result" id="conduitResult">
        Smallest Suitable Conduit: -
      </div>
    </form>
  </div>
  <script src="script.js"></script>
  <script>
    // Cable diameters (approximate mm)
    const CABLE_DB = {
      single: [
        { area: 1.5, diameter: 3.2 },
        { area: 2.5, diameter: 3.7 },
        { area: 4, diameter: 4.6 },
        { area: 6, diameter: 5.2 },
        { area: 10, diameter: 6.8 },
        { area: 16, diameter: 8.5 },
        { area: 25, diameter: 10.3 },
        { area: 35, diameter: 11.6 },
        { area: 50, diameter: 13.5 },
        { area: 70, diameter: 15.5 },
        { area: 95, diameter: 17.8 },
        { area: 120, diameter: 19.5 },
        { area: 150, diameter: 21.8 },
        { area: 185, diameter: 24.5 },
        { area: 240, diameter: 27.5 }
      ],
      multicore: [
        { area: 1.5, diameter: 9.6 },
        { area: 2.5, diameter: 11.3 },
        { area: 4, diameter: 13.2 },
        { area: 6, diameter: 15.1 },
        { area: 10, diameter: 18.5 },
        { area: 16, diameter: 21.5 },
        { area: 25, diameter: 25.5 },
        { area: 35, diameter: 28.5 },
        { area: 50, diameter: 33.5 },
        { area: 70, diameter: 38.5 },
        { area: 95, diameter: 43.5 },
        { area: 120, diameter: 48.5 },
        { area: 150, diameter: 54.0 },
        { area: 185, diameter: 60.0 },
        { area: 240, diameter: 68.0 }
      ]
    };

    // Conduit Dimensions (Nominal OD : Internal Diameter mm)
    // Based on Medium Duty Rigid PVC
    const CONDUIT_DATA = [
      { od: 20, id: 16.1 },
      { od: 25, id: 21.2 },
      { od: 32, id: 28.0 },
      { od: 40, id: 35.4 },
      { od: 50, id: 44.2 },
      { od: 63, id: 56.8 },
      { od: 80, id: 72.5 }, // Approx
      { od: 100, id: 93.0 }, // Approx
      { od: 125, id: 116.0 }, // Approx
      { od: 150, id: 140.0 } // Approx
    ];

    const conduitAreas = CONDUIT_DATA.map(c => ({
      od: c.od,
      area: Math.PI * Math.pow(c.id / 2, 2)
    }));

    function diameterToArea(d) {
      return Math.PI * Math.pow(d/2, 2);
    }

    function getFillPercentage(numCables) {
      // AS/NZS 3000:2018 Appendix C - Conduit fill factors
      if (numCables === 1) return 0.50;
      if (numCables === 2) return 0.33;
      if (numCables >= 3) return 0.40;
      return 0;
    }

    function findSmallestConduit(totalCableArea, numCables) {
      const fill = getFillPercentage(numCables);
      for (let i=0; i<conduitAreas.length; ++i) {
        const allowed = conduitAreas[i].area * fill;
        if (totalCableArea <= allowed) {
          return conduitAreas[i].od;
        }
      }
      return null;
    }

    function buildCableTable() {
      const type = document.getElementById('cableTypeSelect').value;
      const data = CABLE_DB[type];
      const tbody = document.getElementById('cableTableBody');
      
      // Store current values if any
      const currentValues = {};
      const inputs = tbody.querySelectorAll('input');
      inputs.forEach(input => {
        currentValues[input.dataset.area] = input.value;
      });

      tbody.innerHTML = '';
      data.forEach((cable, idx) => {
        const tr = document.createElement('tr');
        const val = currentValues[cable.area] || 0;
        tr.innerHTML = `
          <td>${cable.area}</td>
          <td>
            <input type="number" min="0" value="${val}" id="cableCount${idx}" data-idx="${idx}" data-area="${cable.area}" />
          </td>
        `;
        tbody.appendChild(tr);
      });
      setupListeners(); // Re-attach listeners
    }

    function updateTotalArea() {
      const type = document.getElementById('cableTypeSelect').value;
      const data = CABLE_DB[type];
      let total = 0;
      let numCables = 0;
      
      data.forEach((cable, idx) => {
        const el = document.getElementById(`cableCount${idx}`);
        if (el) {
          const count = parseInt(el.value) || 0;
          const area = diameterToArea(cable.diameter);
          total += count * area;
          numCables += count;
        }
      });

      let resultText = "Smallest Suitable Conduit: -";
      if (numCables > 0 && total > 0) {
        const result = findSmallestConduit(total, numCables);
        if (result) {
          resultText = `Smallest Suitable Conduit: <b>${result} mm</b>`;
        } else {
          resultText = "No suitable conduit size found for this fill.";
        }
      }
      document.getElementById('conduitResult').innerHTML = resultText;
    }

    function setupListeners() {
      const type = document.getElementById('cableTypeSelect').value;
      const data = CABLE_DB[type];
      data.forEach((cable, idx) => {
        const el = document.getElementById(`cableCount${idx}`);
        if (el) {
          el.addEventListener('input', updateTotalArea);
        }
      });
    }

    document.getElementById('cableTypeSelect').addEventListener('change', () => {
      buildCableTable();
      updateTotalArea();
    });

    buildCableTable();
    updateTotalArea();
  </script>
</body>
</html>
