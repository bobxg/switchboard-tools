<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="icon.png" />
  <title>Busbar Sizing - OMNI</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .calc-section { background: #fff; border: 2px solid #1976d2; padding: 24px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .calc-section h2 { color: #1976d2; margin-top: 0; margin-bottom: 18px; font-size: 1.5em; border-bottom: 2px solid #1976d2; padding-bottom: 10px; }
    .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-bottom: 18px; }
    .input-row.three { grid-template-columns: 1fr 1fr 1fr; }
    .input-group { display: flex; flex-direction: column; }
    .input-group label { margin-bottom: 6px; font-weight: bold; color: #333; font-size: 0.95em; }
    .input-group input, .input-group select { padding: 8px 12px; border: 1px solid #b7c5dd; font-size: 1em; }
    .result-box { background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white; padding: 24px; margin-top: 24px; }
    .result-box h3 { margin-top: 0; }
    .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-top: 16px; }
    .result-item { text-align: center; padding: 16px; background: rgba(255,255,255,0.1); border-radius: 4px; }
    .result-label { font-size: 0.9em; opacity: 0.9; margin-bottom: 8px; }
    .result-value { font-size: 1.5em; font-weight: bold; }
    .info-box { background: #e3f0fc; border-left: 4px solid #1976d2; padding: 16px; margin: 16px 0; font-size: 0.95em; }
    .warn-box { background: #fff3e0; border-left: 4px solid #ff9800; padding: 16px; margin: 16px 0; font-size: 0.95em; }
    .pass-box { background: #e8f5e9; border-left: 4px solid #2e7d32; padding: 16px; margin: 16px 0; }
    .fail-box { background: #ffebee; border-left: 4px solid #c62828; padding: 16px; margin: 16px 0; }
    .calc-button { background: #1976d2; color: white; padding: 12px 32px; border: none; font-size: 1.1em; cursor: pointer; width: 100%; margin-top: 12px; }
    .calc-button:hover { background: #1565c0; }
    .ref-table { width: 100%; border-collapse: collapse; margin: 16px 0; font-size: 0.9em; }
    .ref-table th, .ref-table td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    .ref-table th { background: #1976d2; color: white; }
    .ref-table tr:nth-child(even) { background: #f8f9fa; }
    @media (max-width: 768px) { .input-row, .input-row.three { grid-template-columns: 1fr; } }
    @media print { .top-tabs, .calc-button, .topleft-icon { display: none !important; } .result-box { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }
  </style>
</head>
<body>
  <img src="icon.png" class="topleft-icon" alt="App Icon" />
  <div class="top-tabs">
    <a class="tab" href="index.html">Home</a><a class="tab" href="switchboard.html">Switchboard Sizer</a><a class="tab" href="switchroom.html">Switchroom Sizer</a><a class="tab" href="lightingsearch.html">Lighting Search</a>
    <div class="tab has-dropdown active"><span>Power Systems</span><div class="dropdown-content">
      <a href="cablesizing.html">Cable Sizing</a><a href="cableweight.html">Cable Weight</a><a href="maxdemand.html">Maximum Demand</a><a href="diversity.html">Diversity Factors</a><a href="faultlevel.html">Fault Level</a><a href="loopimpedance.html">Loop Impedance</a><a href="discrimination.html">Discrimination Check</a><a href="txsizing.html">Transformer Sizing</a><a href="gensizing.html">Generator Sizing</a><a href="upssizing.html">UPS Sizing</a><a href="pfcsizing.html">PFC Sizing</a><a href="harmonics.html">Harmonics Analysis</a><a href="busbarsizing.html">Busbar Sizing</a><a href="ctsizing.html">CT Sizing</a><a href="earthing.html">Earthing Calculator</a>
    </div></div>
    <div class="tab has-dropdown"><span>Protection</span><div class="dropdown-content"><a href="rcdselect.html">RCD Selector</a><a href="spdsizing.html">SPD Sizing</a><a href="iprating.html">IP/IK Rating Guide</a><a href="conduit.html">Conduit Sizer</a><a href="pvsizing.html">PV Sizing</a></div></div>
    <div class="tab has-dropdown"><span>Lighting & Fire</span><div class="dropdown-content"><a href="luxcalc.html">Lux Calculator</a><a href="luxlevels.html">Lux Levels Reference</a><a href="emergencylighting.html">Emergency Lighting</a><a href="fireinterface.html">Fire Interface Matrix</a><a href="smokecontrol.html">Smoke Control</a><a href="essentialservices.html">Essential Services</a></div></div>
    <div class="tab has-dropdown"><span>Documentation</span><div class="dropdown-content"><a href="loadschedule.html">Load Schedule</a><a href="cableschedule.html">Cable Schedule</a><a href="designcert.html">Design Certificate</a><a href="tcommissioning.html">T&C Checklists</a><a href="inspection.html">Site Inspection</a><a href="sld.html">Single Line Diagram</a><a href="as3000tips.html">AS3000 Tips</a><a href="as3000viewer.html">AS3000 Viewer</a></div></div>
    <a class="tab" href="qa.html">Verification</a>
  </div>
  <div class="main-content">
    <h1>Busbar Sizing Calculator</h1>
    <p>Size copper busbars per <strong>AS/NZS 61439</strong> and IEC 60439. Calculates current capacity, temperature rise, and short-circuit withstand.</p>

    <div class="calc-section">
      <h2>Busbar Parameters</h2>
      <div class="info-box"><strong>AS/NZS 61439.1:</strong> Low-voltage switchgear and controlgear assemblies. Busbars must be rated for continuous current, short-time withstand current, and temperature rise limits.</div>
      <div class="input-row three">
        <div class="input-group"><label for="designCurrent">Design Current (A)</label><input type="number" id="designCurrent" value="1600" min="100" /></div>
        <div class="input-group"><label for="faultCurrent">Prospective Fault Current (kA)</label><input type="number" id="faultCurrent" value="36" min="1" step="0.5" /></div>
        <div class="input-group"><label for="faultDuration">Fault Duration (s)</label>
          <select id="faultDuration"><option value="0.1">0.1 s</option><option value="0.3">0.3 s</option><option value="0.5">0.5 s</option><option value="1" selected>1.0 s</option><option value="3">3.0 s</option></select></div>
      </div>
      <div class="input-row three">
        <div class="input-group"><label for="barMaterial">Material</label>
          <select id="barMaterial"><option value="copper" selected>Copper (ETP Cu)</option><option value="aluminium">Aluminium (EC grade)</option></select></div>
        <div class="input-group"><label for="ambientTemp">Ambient Temperature (°C)</label><input type="number" id="ambientTemp" value="40" min="20" max="55" /></div>
        <div class="input-group"><label for="maxTemp">Max Operating Temperature (°C)</label>
          <select id="maxTemp"><option value="70">70°C (standard)</option><option value="90">90°C (silver-plated joints)</option><option value="105">105°C (insulated bars)</option></select></div>
      </div>
      <button class="calc-button" onclick="calculate()">Size Busbar</button>
    </div>

    <div id="resultSection" style="display:none;">
      <div class="result-box">
        <h3>Busbar Selection</h3>
        <div class="result-grid">
          <div class="result-item"><div class="result-label">Busbar Size</div><div class="result-value" id="resSize">—</div></div>
          <div class="result-item"><div class="result-label">Bars per Phase</div><div class="result-value" id="resBarsPerPhase">—</div></div>
          <div class="result-item"><div class="result-label">Continuous Rating</div><div class="result-value" id="resRating">—</div></div>
          <div class="result-item"><div class="result-label">Temp Rise (ΔT est.)</div><div class="result-value" id="resTempRise">—</div></div>
          <div class="result-item"><div class="result-label">SC Withstand (kA/1s)</div><div class="result-value" id="resSC">—</div></div>
        </div>
      </div>
      <div id="notes"></div>
    </div>

    <div class="calc-section">
      <h2>Standard Copper Busbar Current Ratings</h2>
      <div class="info-box">Ratings based on a single vertical bar, 40°C ambient, 70°C max temperature (30°C rise), natural convection. For multiple bars per phase, apply derating factor for proximity (~0.85 for 2 bars, ~0.78 for 3 bars).</div>
      <table class="ref-table" id="ratingTable">
        <thead><tr><th>Width × Thickness (mm)</th><th>Cross Section (mm²)</th><th>Rating @ 30°C Rise (A)</th><th>SC Withstand (kA/1s)</th><th>Weight (kg/m)</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="calc-section">
      <h2>Design Notes</h2>
      <div class="info-box">
        <strong>Busbar design considerations per AS/NZS 61439:</strong>
        <ul>
          <li><strong>Temperature rise:</strong> Max 70°C for tin-plated joints, 90°C for silver-plated joints, 105°C for insulated bars (above 40°C ambient)</li>
          <li><strong>Short-circuit:</strong> Busbar must withstand Icw (rated short-time withstand current) for rated duration. Copper: 13 A/mm² per √s; Aluminium: 8.5 A/mm² per √s</li>
          <li><strong>Electrodynamic forces:</strong> For fault currents >25 kA, verify busbar support spacing for electromagnetic forces: F = 0.2 × Ipk² × L / d (N/m)</li>
          <li><strong>Voltage drop:</strong> Busbar voltage drop = I × (R×cos φ + X×sin φ) × L. Typically negligible for short bus lengths</li>
          <li><strong>Earth bar:</strong> Size earth busbar for at least 50% of phase busbar cross-section (AS/NZS 3000)</li>
          <li><strong>Neutral bar:</strong> Full-size neutral for harmonic-rich loads (3rd harmonic). Can be 50% of phase for linear balanced loads</li>
        </ul>
      </div>
    </div>
  </div>
  <script>
    // Standard copper busbar sizes [width mm, thickness mm, rating A @ 30°C rise single bar vertical]
    const copperBars = [
      { w: 15, t: 3, rating: 80 },
      { w: 20, t: 3, rating: 115 },
      { w: 20, t: 5, rating: 145 },
      { w: 25, t: 3, rating: 140 },
      { w: 25, t: 5, rating: 175 },
      { w: 30, t: 5, rating: 210 },
      { w: 30, t: 10, rating: 330 },
      { w: 40, t: 5, rating: 270 },
      { w: 40, t: 10, rating: 430 },
      { w: 50, t: 5, rating: 335 },
      { w: 50, t: 10, rating: 530 },
      { w: 60, t: 5, rating: 395 },
      { w: 60, t: 10, rating: 630 },
      { w: 80, t: 5, rating: 510 },
      { w: 80, t: 10, rating: 810 },
      { w: 100, t: 5, rating: 620 },
      { w: 100, t: 10, rating: 1000 },
      { w: 120, t: 10, rating: 1180 },
      { w: 160, t: 10, rating: 1510 },
      { w: 200, t: 10, rating: 1830 },
    ];

    const aluminiumFactor = 0.6; // Aluminium rating ≈ 60% of copper

    function barArea(bar) { return bar.w * bar.t; }
    function scWithstand(area_mm2, material, duration) {
      // Copper: 13 A/mm²/√s (from IEC 61439 / IEEE)
      // Aluminium: 8.5 A/mm²/√s
      const k = material === 'copper' ? 13 : 8.5;
      return (k * area_mm2) / (Math.sqrt(duration) * 1000); // kA
    }

    function calculate() {
      const designA = parseFloat(document.getElementById('designCurrent').value);
      const faultKA = parseFloat(document.getElementById('faultCurrent').value);
      const faultDur = parseFloat(document.getElementById('faultDuration').value);
      const material = document.getElementById('barMaterial').value;
      const ambTemp = parseFloat(document.getElementById('ambientTemp').value);
      const maxTemp = parseFloat(document.getElementById('maxTemp').value);

      const tempRiseAllowed = maxTemp - ambTemp;
      const matFactor = material === 'copper' ? 1.0 : aluminiumFactor;
      // Temp rise correction: rating ∝ √(ΔT_actual / ΔT_ref)
      const tempFactor = Math.sqrt(tempRiseAllowed / 30);

      // Try single bar first, then 2 bars, then 3
      let selectedBar = null;
      let numBars = 1;
      let totalRating = 0;

      for (let n = 1; n <= 4; n++) {
        const proxFactor = n === 1 ? 1.0 : n === 2 ? 0.85 : n === 3 ? 0.78 : 0.72;
        for (const bar of copperBars) {
          const rating = bar.rating * matFactor * tempFactor * n * proxFactor;
          const sc = scWithstand(barArea(bar) * n, material, faultDur);
          if (rating >= designA && sc >= faultKA) {
            selectedBar = bar;
            numBars = n;
            totalRating = rating;
            break;
          }
        }
        if (selectedBar) break;
      }

      if (!selectedBar) {
        selectedBar = copperBars[copperBars.length - 1];
        numBars = 4;
        totalRating = selectedBar.rating * matFactor * tempFactor * numBars * 0.72;
      }

      const area = barArea(selectedBar) * numBars;
      const sc = scWithstand(area, material, faultDur);
      const tempRise = tempRiseAllowed * Math.pow(designA / totalRating, 2);

      const barLabel = numBars > 1 ? `${numBars}× ${selectedBar.w}×${selectedBar.t}` : `${selectedBar.w}×${selectedBar.t}`;

      document.getElementById('resSize').textContent = barLabel + ' mm';
      document.getElementById('resBarsPerPhase').textContent = numBars;
      document.getElementById('resRating').textContent = Math.round(totalRating) + ' A';
      document.getElementById('resTempRise').textContent = tempRise.toFixed(0) + '°C';
      document.getElementById('resSC').textContent = sc.toFixed(1) + ' kA';

      let notes = '';
      if (totalRating >= designA) {
        notes += `<div class="pass-box"><strong>✓ Current capacity OK.</strong> Selected ${barLabel} mm ${material} — rated ${Math.round(totalRating)} A ≥ design ${designA} A (${(designA/totalRating*100).toFixed(0)}% utilisation).</div>`;
      } else {
        notes += `<div class="fail-box"><strong>⚠ Underrated.</strong> Maximum available configuration only provides ${Math.round(totalRating)} A. Consider parallel busbars or larger enclosure.</div>`;
      }
      if (sc >= faultKA) {
        notes += `<div class="pass-box"><strong>✓ Short-circuit withstand OK.</strong> ${sc.toFixed(1)} kA for ${faultDur}s ≥ prospective ${faultKA} kA.</div>`;
      } else {
        notes += `<div class="fail-box"><strong>⚠ Insufficient SC withstand.</strong> ${sc.toFixed(1)} kA < ${faultKA} kA for ${faultDur}s. Increase busbar cross-section or reduce fault clearance time.</div>`;
      }
      notes += `<div class="info-box"><strong>Earth bus:</strong> Minimum ${Math.round(area*0.5)} mm² (50% of phase). <strong>Neutral bus:</strong> ${Math.round(area)} mm² (full size recommended for harmonic loads).</div>`;

      document.getElementById('notes').innerHTML = notes;
      document.getElementById('resultSection').style.display = 'block';

      // Populate reference table
      const tbody = document.querySelector('#ratingTable tbody');
      let html = '';
      copperBars.forEach(bar => {
        const a = barArea(bar);
        const r = Math.round(bar.rating * matFactor * tempFactor);
        const s = scWithstand(a, material, 1);
        const wt = (a * (material === 'copper' ? 8.96 : 2.7) / 1000).toFixed(2);
        const sel = (bar === selectedBar) ? ' style="background:#bbdefb;font-weight:bold;"' : '';
        html += `<tr${sel}><td>${bar.w} × ${bar.t}</td><td>${a}</td><td>${r}</td><td>${s.toFixed(1)}</td><td>${wt}</td></tr>`;
      });
      tbody.innerHTML = html;
    }
  </script>
</body>
</html>
