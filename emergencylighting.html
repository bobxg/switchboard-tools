<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Emergency Lighting - Switchboard Tools</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .calc-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    .calc-section {
      background: #fff;
      border: 2px solid #1976d2;
      padding: 24px;
      margin-bottom: 20px;
    }
    .calc-section h2 {
      color: #1976d2;
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.5em;
      border-bottom: 2px solid #1976d2;
      padding-bottom: 10px;
    }
    .input-group {
      margin-bottom: 20px;
    }
    .input-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 6px;
      color: #333;
    }
    .input-group input,
    .input-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      font-size: 1em;
      box-sizing: border-box;
    }
    .input-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .result-box {
      background: #e3f2fd;
      border: 2px solid #1976d2;
      border-radius: 4px;
      padding: 20px;
      margin: 20px 0;
    }
    .result-box h3 {
      color: #1976d2;
      margin-top: 0;
      margin-bottom: 15px;
    }
    .result-value {
      font-size: 2em;
      font-weight: bold;
      color: #1976d2;
      margin: 10px 0;
    }
    .result-detail {
      font-size: 1em;
      color: #555;
      margin: 8px 0;
    }
    .warning-box {
      background: #fff3cd;
      border-left: 4px solid #ff9800;
      padding: 16px;
      margin: 16px 0;
    }
    .info-box {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 16px;
      margin: 16px 0;
    }
    .reference-table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
    }
    .reference-table th,
    .reference-table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    .reference-table th {
      background: #1976d2;
      color: white;
      font-weight: bold;
    }
    .reference-table tr:nth-child(even) {
      background: #f9f9f9;
    }
    .note-text {
      font-size: 0.9em;
      color: #555;
      margin: 8px 0 0 0;
    }
  </style>
</head>
<body>
  <div class="top-tabs">
    <a class="tab" href="index.html">Home</a><a class="tab" href="switchboard.html">Switchboard Sizer</a><a class="tab" href="switchroom.html">Switchroom Sizer</a><a class="tab" href="lightingsearch.html">Lighting Search</a>
    <div class="tab has-dropdown"><span>Power Systems</span><div class="dropdown-content">
      <a href="cablesizing.html">Cable Sizing</a><a href="cableweight.html">Cable Weight</a><a href="maxdemand.html">Maximum Demand</a><a href="diversity.html">Diversity Factors</a><a href="faultlevel.html">Fault Level</a><a href="loopimpedance.html">Loop Impedance</a><a href="discrimination.html">Discrimination Check</a><a href="txsizing.html">Transformer Sizing</a><a href="gensizing.html">Generator Sizing</a><a href="upssizing.html">UPS Sizing</a><a href="pfcsizing.html">PFC Sizing</a><a href="harmonics.html">Harmonics Analysis</a><a href="busbarsizing.html">Busbar Sizing</a><a href="ctsizing.html">CT Sizing</a><a href="earthing.html">Earthing Calculator</a>
    </div></div>
    <div class="tab has-dropdown"><span>Protection</span><div class="dropdown-content"><a href="rcdselect.html">RCD Selector</a><a href="spdsizing.html">SPD Sizing</a><a href="iprating.html">IP/IK Rating Guide</a><a href="conduit.html">Conduit Sizer</a><a href="pvsizing.html">PV Sizing</a></div></div>
    <div class="tab has-dropdown active"><span>Lighting & Fire</span><div class="dropdown-content"><a href="luxcalc.html">Lux Calculator</a><a href="luxlevels.html">Lux Levels Reference</a><a href="emergencylighting.html">Emergency Lighting</a><a href="fireinterface.html">Fire Interface Matrix</a><a href="smokecontrol.html">Smoke Control</a><a href="essentialservices.html">Essential Services</a></div></div>
    <div class="tab has-dropdown"><span>Documentation</span><div class="dropdown-content"><a href="loadschedule.html">Load Schedule</a><a href="cableschedule.html">Cable Schedule</a><a href="designcert.html">Design Certificate</a><a href="tcommissioning.html">T&C Checklists</a><a href="inspection.html">Site Inspection</a><a href="sld.html">Single Line Diagram</a><a href="as3000tips.html">AS3000 Tips</a><a href="as3000viewer.html">AS3000 Viewer</a></div></div>
    <a class="tab" href="qa.html">Verification</a>
  </div>

  <div class="calc-container">
    <div class="calc-section">
      <h2>Emergency Luminaire Spacing Calculator - AS/NZS 2293</h2>
      
      <div class="input-group">
        <label for="areaType">Area Classification:</label>
        <select id="areaType">
          <option value="escape">Escape Routes / Corridors (1.0 lux required)</option>
          <option value="open">Open Areas > 60mÂ² (0.5 lux required)</option>
          <option value="highrisk">High Risk Task Areas (10 lux required)</option>
          <option value="carpark">Covered Car Parks (1.0 lux required)</option>
        </select>
      </div>

      <div class="input-row">
        <div class="input-group">
          <label for="calcMode">Calculation Mode:</label>
          <select id="calcMode" onchange="toggleMode()">
            <option value="class">AS/NZS 2293 Classification (Recommended)</option>
            <option value="lumen">Lumen Output (Approximate)</option>
          </select>
        </div>
        <div class="input-group" id="classInputGroup">
          <label for="classification">Luminaire Classification:</label>
          <select id="classification">
            <option value="D25">D25</option>
            <option value="D32">D32</option>
            <option value="D40" selected>D40 (Typical LED)</option>
            <option value="D50">D50</option>
            <option value="D63">D63</option>
            <option value="C25">C25</option>
            <option value="C32">C32</option>
            <option value="C40">C40</option>
            <option value="C50">C50</option>
            <option value="C63">C63</option>
          </select>
        </div>
        <div class="input-group" id="lumenInputGroup" style="display:none;">
          <label for="lumens">Luminaire Output (lumens):</label>
          <input type="number" id="lumens" value="400" min="50" step="10">
        </div>
      </div>
      <p id="modeNotice" class="note-text"></p>

      <div class="input-row">
        <div class="input-group">
          <label for="mountHeight">Mounting Height (m):</label>
          <input type="number" id="mountHeight" value="2.7" min="2.1" max="6" step="0.1">
        </div>
        <div class="input-group" id="widthGroup">
          <label for="corridorWidth" id="widthLabel">Corridor/Path Width (m):</label>
          <input type="number" id="corridorWidth" value="2" min="0.5" max="10" step="0.1">
        </div>
      </div>

      <div class="input-row">
        <div class="input-group" id="reflectanceGroup" style="display:none;">
          <label for="reflectance">Wall/Ceiling Reflectance:</label>
          <select id="reflectance">
            <option value="0.7">Light (70% - White/Cream)</option>
            <option value="0.5" selected>Medium (50% - Light Grey/Beige)</option>
            <option value="0.3">Dark (30% - Dark Grey/Wood)</option>
          </select>
        </div>
      </div>

      <button class="btn btn-primary" onclick="calculateSpacing()" style="width: 100%; padding: 14px; font-size: 1.1em; margin-top: 10px;">Calculate Spacing</button>

      <div id="results" style="display: none;">
        <div class="result-box">
          <h3>Maximum Luminaire Spacing</h3>
          <div class="result-value" id="maxSpacing">-</div>
          <div class="result-detail" id="spacingDetail">-</div>
        </div>

        <div id="complianceCheck"></div>

        <div class="info-box">
          <strong>Calculation Method:</strong>
          <p id="calcMethod" style="margin: 8px 0 0 0;">-</p>
        </div>
      </div>
    </div>

    <div class="calc-section">
      <h2>Quick Reference - Typical Luminaire Outputs</h2>

      <table class="reference-table">
        <thead>
          <tr>
            <th>Luminaire Type</th>
            <th>Typical Output</th>
            <th>Application</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>2W LED Emergency</td>
            <td>200-300 lm</td>
            <td>Small corridors, narrow paths</td>
          </tr>
          <tr>
            <td>3W LED Emergency</td>
            <td>300-450 lm</td>
            <td>Standard corridors (1.5-2m wide)</td>
          </tr>
          <tr>
            <td>5W LED Emergency</td>
            <td>500-700 lm</td>
            <td>Wide corridors, medium rooms</td>
          </tr>
          <tr>
            <td>8W LED Emergency</td>
            <td>800-1000 lm</td>
            <td>Large open areas, warehouses</td>
          </tr>
          <tr>
            <td>Exit Sign with Spear</td>
            <td>150-250 lm</td>
            <td>Exit indication + limited path light</td>
          </tr>
        </tbody>
      </table>

      <div class="warning-box">
        <strong>Important Notes:</strong>
        <ul style="margin: 8px 0 0 20px;">
          <li>Values assume clean, maintained luminaires</li>
          <li>Reduce spacing by 20-30% for dark surfaces or complex layouts</li>
          <li>Heights above 3.5m require increased luminaire output or reduced spacing</li>
          <li>Check manufacturer's photometric data for specific luminaires</li>
        </ul>
      </div>
    </div>

    <div class="calc-section">
      <h2>AS/NZS 2293 Requirements Summary</h2>
      
      <table class="reference-table">
        <thead>
          <tr>
            <th>Area Type</th>
            <th>Required Lux</th>
            <th>Duration</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Escape Routes / Corridors</td>
            <td>1.0 lux minimum</td>
            <td>90 minutes</td>
          </tr>
          <tr>
            <td>Open Areas > 60mÂ²</td>
            <td>0.5 lux minimum</td>
            <td>90 minutes</td>
          </tr>
          <tr>
            <td>High Risk Task Areas</td>
            <td>10 lux minimum</td>
            <td>90 minutes</td>
          </tr>
          <tr>
            <td>Covered Car Parks</td>
            <td>1.0 lux minimum</td>
            <td>90 minutes</td>
          </tr>
          <tr>
            <td>Staged Evacuation Buildings</td>
            <td>As per area type</td>
            <td>120 minutes</td>
          </tr>
        </tbody>
      </table>

      <div class="info-box">
        <strong>Testing Requirements:</strong>
        <ul style="margin: 8px 0 0 20px;">
          <li>Simulated power failure test: Every 6 months</li>
          <li>Full duration discharge test: Annually</li>
          <li>Visual inspection: Monthly</li>
          <li>Record all tests in maintenance log</li>
        </ul>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    const CLASSIFICATION_SETS = {
      escape: ['D25', 'D32', 'D40', 'D50', 'D63'],
      carpark: ['D25', 'D32', 'D40', 'D50', 'D63'],
      open: ['C25', 'C32', 'C40', 'C50', 'C63']
    };

    const CLASSIFICATION_DEFAULT = {
      escape: 'D40',
      carpark: 'D40',
      open: 'C40'
    };

    const MODE_NOTES = {
      escape: 'Use D-class (corridor) classifications for escape routes per AS/NZS 2293.1 spacing tables.',
      carpark: 'Covered car parks adopt D-class corridor ratings (AS/NZS 2293.1) for 1 lux along drive aisles.',
      open: 'Open areas > 60mÂ² require C-class area classifications in accordance with AS/NZS 2293.1.'
    };

    const HIGH_RISK_NOTE = 'High risk task areas require point-by-point design (AS/NZS 2293.1 Clause 4.5); use the lumen method with manufacturer photometry.';

    // Simplified Spacing Tables (AS/NZS 2293.1)
    // Max spacing for 1 lux (Escape Route)
    const SPACING_TABLE = {
      'D25': { 2.1: 14.2, 2.4: 14.8, 2.7: 15.3, 3.0: 15.7, 3.3: 16.0, 3.6: 16.2, 4.0: 16.4, 4.5: 16.5, 5.0: 16.4, 6.0: 15.8 },
      'D32': { 2.1: 15.4, 2.4: 16.1, 2.7: 16.7, 3.0: 17.2, 3.3: 17.6, 3.6: 17.9, 4.0: 18.2, 4.5: 18.5, 5.0: 18.6, 6.0: 18.4 },
      'D40': { 2.1: 16.1, 2.4: 17.0, 2.7: 17.7, 3.0: 18.3, 3.3: 18.9, 3.6: 19.3, 4.0: 19.8, 4.5: 20.2, 5.0: 20.5, 6.0: 20.7 },
      'D50': { 2.1: 16.7, 2.4: 17.8, 2.7: 18.7, 3.0: 19.4, 3.3: 20.1, 3.6: 20.7, 4.0: 21.3, 4.5: 21.9, 5.0: 22.3, 6.0: 22.9 },
      'D63': { 2.1: 17.2, 2.4: 18.5, 2.7: 19.6, 3.0: 20.5, 3.3: 21.3, 3.6: 22.0, 4.0: 22.8, 4.5: 23.6, 5.0: 24.2, 6.0: 25.1 },
      'C25': { 2.1: 8.6, 2.4: 8.8, 2.7: 9.0, 3.0: 9.1, 3.3: 9.2, 3.6: 9.2, 4.0: 9.2, 4.5: 9.1, 5.0: 8.9, 6.0: 8.3 },
      'C32': { 2.1: 9.4, 2.4: 9.7, 2.7: 9.9, 3.0: 10.1, 3.3: 10.2, 3.6: 10.3, 4.0: 10.4, 4.5: 10.4, 5.0: 10.3, 6.0: 9.9 },
      'C40': { 2.1: 10.1, 2.4: 10.5, 2.7: 10.8, 3.0: 11.0, 3.3: 11.2, 3.6: 11.4, 4.0: 11.5, 4.5: 11.6, 5.0: 11.6, 6.0: 11.4 },
      'C50': { 2.1: 10.8, 2.4: 11.2, 2.7: 11.6, 3.0: 11.9, 3.3: 12.2, 3.6: 12.4, 4.0: 12.6, 4.5: 12.8, 5.0: 12.9, 6.0: 12.9 },
      'C63': { 2.1: 11.4, 2.4: 12.0, 2.7: 12.4, 3.0: 12.8, 3.3: 13.2, 3.6: 13.5, 4.0: 13.8, 4.5: 14.1, 5.0: 14.3, 6.0: 14.5 }
    };

    function toggleMode() {
      const mode = document.getElementById('calcMode').value;
      const classGroup = document.getElementById('classInputGroup');
      const lumenGroup = document.getElementById('lumenInputGroup');
      const reflectanceGroup = document.getElementById('reflectanceGroup');
      const widthGroup = document.getElementById('widthGroup');
      const areaType = document.getElementById('areaType').value;
      const calcModeSelect = document.getElementById('calcMode');
      const classOption = calcModeSelect.querySelector('option[value="class"]');
      const classificationSupported = Boolean(CLASSIFICATION_SETS[areaType]);

      classOption.disabled = !classificationSupported;

      let activeMode = mode;
      if (!classificationSupported && mode === 'class') {
        calcModeSelect.value = 'lumen';
        activeMode = 'lumen';
      }
      
      if (activeMode === 'class') {
        classGroup.style.display = 'block';
        lumenGroup.style.display = 'none';
        reflectanceGroup.style.display = 'none';
        widthGroup.style.display = 'none';
      } else {
        classGroup.style.display = 'none';
        lumenGroup.style.display = 'block';
        reflectanceGroup.style.display = 'block';
        widthGroup.style.display = 'block';
      }

      calculateSpacing();
    }

    function getSpacingFromTable(classification, height) {
      const data = SPACING_TABLE[classification];
      if (!data) return null;

      // Find closest heights
      const heights = Object.keys(data).map(parseFloat).sort((a, b) => a - b);
      
      if (height <= heights[0]) return data[heights[0]];
      if (height >= heights[heights.length - 1]) return data[heights[heights.length - 1]];

      // Interpolate
      for (let i = 0; i < heights.length - 1; i++) {
        if (height >= heights[i] && height <= heights[i+1]) {
          const h1 = heights[i];
          const h2 = heights[i+1];
          const s1 = data[h1];
          const s2 = data[h2];
          return s1 + (s2 - s1) * (height - h1) / (h2 - h1);
        }
      }
      return 0;
    }

    function updateClassificationOptions() {
      const areaType = document.getElementById('areaType').value;
      const classificationSelect = document.getElementById('classification');
      const allowed = CLASSIFICATION_SETS[areaType];
      const options = Array.from(classificationSelect.options);

      if (!allowed) {
        classificationSelect.disabled = true;
        options.forEach(option => {
          option.hidden = false;
          option.disabled = false;
        });
        return;
      }

      classificationSelect.disabled = false;
      options.forEach(option => {
        if (!option.value) return;
        const showOption = allowed.includes(option.value);
        option.hidden = !showOption;
        option.disabled = !showOption;
      });

      if (!allowed.includes(classificationSelect.value)) {
        classificationSelect.value = CLASSIFICATION_DEFAULT[areaType] || allowed[0];
      }
    }

    function updateModeNotice(areaType) {
      const notice = document.getElementById('modeNotice');
      if (!notice) return;

      if (!CLASSIFICATION_SETS[areaType]) {
        notice.textContent = HIGH_RISK_NOTE;
        return;
      }

      notice.textContent = MODE_NOTES[areaType] || '';
    }

    function updateWidthLabel(areaType) {
      const label = document.getElementById('widthLabel');
      if (!label) return;

      switch(areaType) {
        case 'open':
          label.textContent = 'Grid Width / Cell Size (m):';
          break;
        case 'highrisk':
          label.textContent = 'Task Width Across Work Plane (m):';
          break;
        case 'carpark':
          label.textContent = 'Drive Aisle Width (m):';
          break;
        default:
          label.textContent = 'Corridor/Path Width (m):';
      }
    }

    function handleAreaChange() {
      const areaType = document.getElementById('areaType').value;
      updateClassificationOptions();
      updateModeNotice(areaType);
      updateWidthLabel(areaType);
      toggleMode();
    }

    function calculateSpacing() {
      // Get inputs
      const mode = document.getElementById('calcMode').value;
      const areaType = document.getElementById('areaType').value;
      const mountHeight = parseFloat(document.getElementById('mountHeight').value);
      const corridorWidth = parseFloat(document.getElementById('corridorWidth').value);
      
      let maxSpacing = 0;
      let calcMethodText = '';

      // Determine required lux based on area type
      let requiredLux;
      let areaName;
      switch(areaType) {
        case 'escape':
          requiredLux = 1.0;
          areaName = 'Escape Routes';
          break;
        case 'open':
          requiredLux = 0.5;
          areaName = 'Open Areas > 60mÂ²';
          break;
        case 'highrisk':
          requiredLux = 10.0;
          areaName = 'High Risk Task Areas';
          break;
        case 'carpark':
          requiredLux = 1.0;
          areaName = 'Covered Car Parks';
          break;
      }

      if (mode === 'class') {
        const classification = document.getElementById('classification').value;
        
        // Get base spacing for 1 lux
        let baseSpacing = getSpacingFromTable(classification, mountHeight);
        
        // Adjust for other lux levels (Approximate inverse square law relationship for spacing? 
        // Actually, spacing tables are specific. For 0.5 lux, spacing is wider. For 10 lux, much closer.
        // This is a limitation of the simplified tool. We will apply a factor.)
        
        let luxFactor = 1.0;
        if (requiredLux === 0.5) luxFactor = 1.25; // Approx wider spacing
        if (requiredLux === 10.0) luxFactor = 0.35; // Much closer spacing
        
        maxSpacing = baseSpacing * luxFactor;
        
        calcMethodText = `Based on AS/NZS 2293 Classification ${classification} at ${mountHeight}m height. ` +
                         `Base spacing for 1 lux: ${baseSpacing.toFixed(1)}m. ` +
                         `Adjusted for ${requiredLux} lux (${areaName}).`;

      } else {
        // Lumen Method (Existing)
        const lumens = parseFloat(document.getElementById('lumens').value);
        const reflectance = parseFloat(document.getElementById('reflectance').value);
        
        // Apply reflectance factor (lower reflectance reduces effective lumens)
        const effectiveLumens = lumens * (0.5 + reflectance * 0.5);

        // Calculate spacing using lumen method with corridor geometry
        const utilizationFactor = 0.4 + (reflectance * 0.2); // 0.4-0.6 depending on reflectance
        const maintenanceFactor = 0.8; // Account for dirt and aging
        
        // Simplified spacing calculation
        maxSpacing = Math.sqrt((effectiveLumens * utilizationFactor * maintenanceFactor) / (requiredLux * corridorWidth));
        
        calcMethodText = `Calculated using Lumen Method (Approximate) for ${areaName} (${requiredLux} lux required) with ${lumens}lm luminaire.`;
      }
      
      // Apply mounting height constraint (spacing shouldn't exceed 4x mounting height generally)
      // AS/NZS 2293 tables already account for this, but for lumen method we need a cap
      let heightLimited = false;
      if (mode === 'lumen') {
        const heightLimit = mountHeight * 3;
        if (maxSpacing > heightLimit) {
          maxSpacing = heightLimit;
          heightLimited = true;
        }
      }

      // Round to 1 decimal
      maxSpacing = Math.round(maxSpacing * 10) / 10;

      // Calculate number of luminaires needed for a typical 50m corridor
      const testLength = 50;
      const numLuminaires = Math.ceil(testLength / maxSpacing);
      const actualSpacing = testLength / numLuminaires;

      // Display results
      document.getElementById('results').style.display = 'block';
      document.getElementById('maxSpacing').textContent = maxSpacing.toFixed(1) + ' meters';
      document.getElementById('spacingDetail').textContent = 
        `For a ${testLength}m corridor: ${numLuminaires} luminaires at ${actualSpacing.toFixed(1)}m spacing`;

      // Compliance check
      let complianceHTML = '';
      if (maxSpacing < 6) {
        complianceHTML = '<div class="warning-box"><strong>Warning:</strong> Very close spacing required. Consider higher output luminaires.</div>';
      } else if (maxSpacing > 25) {
        complianceHTML = '<div class="warning-box"><strong>Note:</strong> Wide spacing possible. Verify with photometric data and check for obstructions.</div>';
      } else {
        complianceHTML = '<div class="info-box"><strong>Compliant:</strong> Spacing is within typical range for emergency lighting.</div>';
      }

      // Add height warning
      if (mountHeight > 4.0 && mode === 'lumen') {
        complianceHTML += '<div class="warning-box"><strong>High Mounting:</strong> Height > 4.0m. Lumen method becomes less accurate. Use manufacturer photometry or AS/NZS 2293 classification tables.</div>';
      }

      if (heightLimited) {
        complianceHTML += '<div class="warning-box"><strong>Spacing Limited:</strong> Capped at 3Ã— mounting height per AS/NZS 2293 design guidance to control uniformity.</div>';
      }

      document.getElementById('complianceCheck').innerHTML = complianceHTML;

      // Calculation method explanation
      document.getElementById('calcMethod').textContent = calcMethodText;

      // Scroll to results
      document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // Calculate on load with default values
    document.getElementById('areaType').addEventListener('change', handleAreaChange);
    document.getElementById('classification').addEventListener('change', calculateSpacing);
    document.getElementById('lumens').addEventListener('change', calculateSpacing);
    document.getElementById('mountHeight').addEventListener('change', calculateSpacing);
    document.getElementById('corridorWidth').addEventListener('change', calculateSpacing);
    document.getElementById('reflectance').addEventListener('change', calculateSpacing);

    window.addEventListener('load', () => {
      handleAreaChange();
    });
  </script>
</body>
</html>
