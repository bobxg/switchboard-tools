<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="icon.png" />
  <title>Voltage Drop - Switchboard Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <style>
    .calculator-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    .calc-section {
      background: #fff;
      border: 2px solid #1976d2;
      border-radius: 0;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .calc-section h2 {
      color: #1976d2;
      margin-bottom: 18px;
      font-size: 1.6em;
      font-weight: normal;
    }
    .input-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      margin-bottom: 18px;
    }
    .input-group {
      display: flex;
      flex-direction: column;
    }
    .input-group label {
      margin-bottom: 6px;
      font-weight: bold;
      color: #333;
    }
    .input-group input,
    .input-group select {
      padding: 8px 12px;
      border: 1px solid #b7c5dd;
      border-radius: 0;
      font-size: 1em;
    }
    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: #1976d2;
      box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
    }
    .result-box {
      background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
      color: white;
      padding: 24px;
      border-radius: 0;
      margin-top: 24px;
      text-align: center;
    }
    .result-box h3 {
      font-size: 1.2em;
      margin-bottom: 12px;
      font-weight: normal;
    }
    .result-value {
      font-size: 2.5em;
      font-weight: bold;
      margin: 12px 0;
    }
    .result-status {
      font-size: 1.1em;
      margin-top: 12px;
      padding: 8px;
      border-radius: 0;
    }
    .status-ok {
      background: rgba(76, 175, 80, 0.3);
    }
    .status-warning {
      background: rgba(255, 152, 0, 0.3);
    }
    .status-fail {
      background: rgba(244, 67, 54, 0.3);
    }
    .info-box {
      background: #e3f0fc;
      border-left: 4px solid #1976d2;
      padding: 16px;
      margin: 16px 0;
      border-radius: 0;
    }
    .info-box h4 {
      color: #1976d2;
      margin-bottom: 8px;
      font-weight: normal;
    }
    .info-box ul {
      margin-left: 20px;
      line-height: 1.8;
    }
    .calc-button {
      background: #1976d2;
      color: white;
      padding: 12px 32px;
      border: none;
      border-radius: 0;
      font-size: 1.1em;
      cursor: pointer;
      transition: background 0.2s;
      width: 100%;
      margin-top: 12px;
    }
    .calc-button:hover {
      background: #1565c0;
    }
    @media (max-width: 768px) {
      .input-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <img src="icon.png" class="topleft-icon" alt="App Icon" />
  <div class="top-tabs">
    <a class="tab" href="index.html" tabindex="1">Home</a>
    <a class="tab" href="switchboard.html" tabindex="2">Switchboard Sizer</a>
    <a class="tab" href="conduit.html" tabindex="3">Conduit Sizer</a>
    <a class="tab" href="switchroom.html" tabindex="4">Switchroom Sizer</a>
    <a class="tab active" href="voltagedrop.html" tabindex="5">Voltage Drop</a>
  </div>
  
  <div class="main-content">
    <h1>Voltage Drop Calculator (AS/NZS 3000)</h1>
    <p>Calculate voltage drop for electrical circuits in accordance with AS/NZS 3000.</p>

    <div class="calculator-container">
      <div class="calc-section">
        <h2>Circuit Parameters</h2>
        
        <div class="input-row">
          <div class="input-group">
            <label for="systemType">System Type</label>
            <select id="systemType" onchange="calculateVoltageDrop()">
              <option value="single">Single Phase</option>
              <option value="three">Three Phase</option>
            </select>
          </div>
          <div class="input-group">
            <label for="voltage">Nominal Voltage (V)</label>
            <input type="number" id="voltage" value="230" onchange="calculateVoltageDrop()" />
          </div>
        </div>

        <div class="input-row">
          <div class="input-group">
            <label for="current">Load Current (A)</label>
            <input type="number" id="current" value="20" step="0.1" onchange="calculateVoltageDrop()" />
          </div>
          <div class="input-group">
            <label for="cableLength">Cable Length (m)</label>
            <input type="number" id="cableLength" value="50" step="0.1" onchange="calculateVoltageDrop()" />
          </div>
        </div>

        <div class="input-row">
          <div class="input-group">
            <label for="cableSize">Cable Size (mm²)</label>
            <select id="cableSize" onchange="calculateVoltageDrop()">
              <option value="1.5">1.5 mm²</option>
              <option value="2.5" selected>2.5 mm²</option>
              <option value="4">4 mm²</option>
              <option value="6">6 mm²</option>
              <option value="10">10 mm²</option>
              <option value="16">16 mm²</option>
              <option value="25">25 mm²</option>
              <option value="35">35 mm²</option>
              <option value="50">50 mm²</option>
              <option value="70">70 mm²</option>
              <option value="95">95 mm²</option>
              <option value="120">120 mm²</option>
              <option value="150">150 mm²</option>
              <option value="185">185 mm²</option>
              <option value="240">240 mm²</option>
              <option value="300">300 mm²</option>
            </select>
          </div>
          <div class="input-group">
            <label for="powerFactor">Power Factor</label>
            <input type="number" id="powerFactor" value="0.9" min="0.1" max="1" step="0.01" onchange="calculateVoltageDrop()" />
          </div>
        </div>

        <div class="input-row">
          <div class="input-group">
            <label for="installMethod">Installation Method</label>
            <select id="installMethod" onchange="calculateVoltageDrop()">
              <option value="normal">Normal (75°C)</option>
              <option value="high">High Temperature (90°C)</option>
            </select>
          </div>
          <div class="input-group">
            <label for="circuitType">Circuit Type</label>
            <select id="circuitType">
              <option value="lighting">Lighting</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>

        <button class="calc-button" onclick="calculateVoltageDrop()">Calculate Voltage Drop</button>
      </div>

      <div class="calc-section">
        <h2>Results</h2>
        <div class="result-box">
          <h3>Voltage Drop</h3>
          <div class="result-value" id="voltageDropValue">0.00 V</div>
          <div id="voltageDropPercent" style="font-size: 1.3em;">0.00%</div>
          <div class="result-status" id="complianceStatus">Enter values and click Calculate</div>
        </div>

        <div class="info-box">
          <h4>AS/NZS 3000 Voltage Drop Limits</h4>
          <ul>
            <li><strong>Lighting circuits:</strong> 3% maximum</li>
            <li><strong>Other circuits:</strong> 5% maximum</li>
            <li>These limits apply to the voltage drop from the origin to the point of utilization</li>
          </ul>
        </div>
      </div>

      <div class="calc-section">
        <h2>Formula Information</h2>
        <div class="info-box">
          <h4>Voltage Drop Calculation</h4>
          <p><strong>Single Phase:</strong></p>
          <p>Vd = 2 × I × L × (R × cos(φ) + X × sin(φ))</p>
          <p style="margin-top: 12px;"><strong>Three Phase:</strong></p>
          <p>Vd = √3 × I × L × (R × cos(φ) + X × sin(φ))</p>
          <p style="margin-top: 12px;">Where:</p>
          <ul>
            <li><strong>Vd</strong> = Voltage drop (V)</li>
            <li><strong>I</strong> = Load current (A)</li>
            <li><strong>L</strong> = Cable length (km)</li>
            <li><strong>R</strong> = Resistance per km (Ω/km)</li>
            <li><strong>X</strong> = Reactance per km (Ω/km)</li>
            <li><strong>φ</strong> = Power factor angle</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    // Cable resistance values (Ω/km) at 75°C for copper conductors
    const cableResistance75C = {
      1.5: 13.3,
      2.5: 7.98,
      4: 4.95,
      6: 3.30,
      10: 1.95,
      16: 1.21,
      25: 0.780,
      35: 0.554,
      50: 0.386,
      70: 0.277,
      95: 0.206,
      120: 0.161,
      150: 0.129,
      185: 0.106,
      240: 0.0801,
      300: 0.0641
    };

    // Cable resistance values (Ω/km) at 90°C for copper conductors
    const cableResistance90C = {
      1.5: 14.0,
      2.5: 8.40,
      4: 5.21,
      6: 3.47,
      10: 2.05,
      16: 1.28,
      25: 0.822,
      35: 0.584,
      50: 0.407,
      70: 0.292,
      95: 0.217,
      120: 0.170,
      150: 0.136,
      185: 0.112,
      240: 0.0845,
      300: 0.0676
    };

    // Cable reactance values (Ω/km) - simplified values
    const cableReactance = {
      1.5: 0.090,
      2.5: 0.085,
      4: 0.082,
      6: 0.080,
      10: 0.078,
      16: 0.076,
      25: 0.074,
      35: 0.073,
      50: 0.072,
      70: 0.071,
      95: 0.070,
      120: 0.069,
      150: 0.069,
      185: 0.068,
      240: 0.068,
      300: 0.067
    };

    function calculateVoltageDrop() {
      const systemType = document.getElementById('systemType').value;
      const voltage = parseFloat(document.getElementById('voltage').value);
      const current = parseFloat(document.getElementById('current').value);
      const cableLength = parseFloat(document.getElementById('cableLength').value);
      const cableSize = parseFloat(document.getElementById('cableSize').value);
      const powerFactor = parseFloat(document.getElementById('powerFactor').value);
      const installMethod = document.getElementById('installMethod').value;
      const circuitType = document.getElementById('circuitType').value;

      if (!current || !cableLength || !voltage) {
        document.getElementById('complianceStatus').textContent = 'Please enter all required values';
        return;
      }

      // Select resistance based on installation method
      const resistanceTable = installMethod === 'high' ? cableResistance90C : cableResistance75C;
      const R = resistanceTable[cableSize]; // Ω/km
      const X = cableReactance[cableSize]; // Ω/km
      const L = cableLength / 1000; // Convert meters to km

      // Calculate impedance components
      const phi = Math.acos(powerFactor);
      const Z = R * Math.cos(phi) + X * Math.sin(phi);

      // Calculate voltage drop
      let voltageDrop;
      if (systemType === 'single') {
        voltageDrop = 2 * current * L * Z;
      } else {
        voltageDrop = Math.sqrt(3) * current * L * Z;
      }

      const voltageDropPercent = (voltageDrop / voltage) * 100;

      // Display results
      document.getElementById('voltageDropValue').textContent = voltageDrop.toFixed(2) + ' V';
      document.getElementById('voltageDropPercent').textContent = voltageDropPercent.toFixed(2) + '%';

      // Check compliance
      const statusDiv = document.getElementById('complianceStatus');
      const maxAllowed = circuitType === 'lighting' ? 3 : 5;
      
      if (voltageDropPercent <= maxAllowed) {
        statusDiv.className = 'result-status status-ok';
        statusDiv.textContent = `COMPLIANT - Within ${maxAllowed}% limit for ${circuitType} circuits`;
      } else if (voltageDropPercent <= maxAllowed + 1) {
        statusDiv.className = 'result-status status-warning';
        statusDiv.textContent = `WARNING - Approaching limit (${maxAllowed}% for ${circuitType} circuits)`;
      } else {
        statusDiv.className = 'result-status status-fail';
        statusDiv.textContent = `NON-COMPLIANT - Exceeds ${maxAllowed}% limit for ${circuitType} circuits`;
      }
    }

    // Calculate on page load
    calculateVoltageDrop();
  </script>
</body>
</html>
