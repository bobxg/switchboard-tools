<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="icon.png" />
  <title>Diversity Factors - OMNI</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .calc-section { background: #fff; border: 2px solid #1976d2; padding: 24px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .calc-section h2 { color: #1976d2; margin-top: 0; margin-bottom: 18px; font-size: 1.5em; border-bottom: 2px solid #1976d2; padding-bottom: 10px; }
    .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-bottom: 18px; }
    .input-row.three { grid-template-columns: 1fr 1fr 1fr; }
    .input-group { display: flex; flex-direction: column; }
    .input-group label { margin-bottom: 6px; font-weight: bold; color: #333; font-size: 0.95em; }
    .input-group input, .input-group select { padding: 8px 12px; border: 1px solid #b7c5dd; font-size: 1em; }
    .result-box { background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white; padding: 24px; margin-top: 24px; }
    .result-box h3 { margin-top: 0; margin-bottom: 12px; font-size: 1.3em; }
    .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 16px; }
    .result-item { text-align: center; padding: 16px; background: rgba(255,255,255,0.1); border-radius: 4px; }
    .result-label { font-size: 0.9em; opacity: 0.9; margin-bottom: 8px; }
    .result-value { font-size: 1.8em; font-weight: bold; }
    .info-box { background: #e3f0fc; border-left: 4px solid #1976d2; padding: 16px; margin: 16px 0; font-size: 0.95em; }
    .diversity-ref { background: #fffbe6; border-left: 4px solid #ffc107; padding: 12px 16px; margin: 12px 0; font-size: 0.9em; }
    .diversity-ref strong { color: #e65100; }
    .calc-button { background: #1976d2; color: white; padding: 12px 32px; border: none; font-size: 1.1em; cursor: pointer; width: 100%; margin-top: 12px; }
    .calc-button:hover { background: #1565c0; }
    .ref-table { width: 100%; border-collapse: collapse; margin: 16px 0; font-size: 0.9em; }
    .ref-table th, .ref-table td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    .ref-table th { background: #1976d2; color: white; }
    .ref-table tr:nth-child(even) { background: #f8f9fa; }
    .ref-table td:first-child { text-align: left; }
    .sub-tabs { display: flex; border-bottom: 3px solid #1976d2; margin-bottom: 24px; flex-wrap: wrap; }
    .sub-tab { padding: 12px 22px; font-size: 1em; font-weight: 600; color: #555; background: #f0f0f0; border: 1px solid #ccc; border-bottom: none; cursor: pointer; margin-right: 2px; border-radius: 6px 6px 0 0; }
    .sub-tab:hover { background: #e3f0fc; color: #1976d2; }
    .sub-tab.active { background: #1976d2; color: #fff; border-color: #1976d2; }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }
    .load-table { width: 100%; border-collapse: collapse; margin: 16px 0; }
    .load-table th, .load-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    .load-table th { background: #1976d2; color: white; font-weight: bold; }
    .load-table tr:nth-child(even) { background: #f8f9fa; }
    .load-table input { width: 80px; padding: 6px 8px; border: 1px solid #b7c5dd; font-size: 0.95em; text-align: right; }
    @media (max-width: 768px) { .input-row, .input-row.three { grid-template-columns: 1fr; } }
    @media print {
      .top-tabs, .calc-button, .sub-tabs, .topleft-icon { display: none !important; }
      .tab-panel { display: block !important; }
    }
  </style>
</head>
<body>
  <img src="icon.png" class="topleft-icon" alt="App Icon" />
  <div class="top-tabs">
    <a class="tab" href="index.html">Home</a>
    <a class="tab" href="switchboard.html">Switchboard Sizer</a>
    <a class="tab" href="switchroom.html">Switchroom Sizer</a>
    <a class="tab" href="lightingsearch.html">Lighting Search</a>
    <div class="tab has-dropdown active">
      <span>Power Systems</span>
      <div class="dropdown-content">
        <a href="cablesizing.html">Cable Sizing</a>
        <a href="cableweight.html">Cable Weight</a>
        <a href="maxdemand.html">Maximum Demand</a>
        <a href="diversity.html">Diversity Factors</a>
        <a href="faultlevel.html">Fault Level</a>
        <a href="loopimpedance.html">Loop Impedance</a>
        <a href="discrimination.html">Discrimination Check</a>
        <a href="txsizing.html">Transformer Sizing</a>
        <a href="gensizing.html">Generator Sizing</a>
        <a href="upssizing.html">UPS Sizing</a>
        <a href="pfcsizing.html">PFC Sizing</a>
        <a href="harmonics.html">Harmonics Analysis</a>
        <a href="busbarsizing.html">Busbar Sizing</a>
        <a href="ctsizing.html">CT Sizing</a>
        <a href="earthing.html">Earthing Calculator</a>
      </div>
    </div>
    <div class="tab has-dropdown">
      <span>Protection</span>
      <div class="dropdown-content">
        <a href="rcdselect.html">RCD Selector</a>
        <a href="spdsizing.html">SPD Sizing</a>
        <a href="iprating.html">IP/IK Rating Guide</a>
        <a href="conduit.html">Conduit Sizer</a>
        <a href="pvsizing.html">PV Sizing</a>
      </div>
    </div>
    <div class="tab has-dropdown">
      <span>Lighting & Fire</span>
      <div class="dropdown-content">
        <a href="luxcalc.html">Lux Calculator</a>
        <a href="luxlevels.html">Lux Levels Reference</a>
        <a href="emergencylighting.html">Emergency Lighting</a>
        <a href="fireinterface.html">Fire Interface Matrix</a>
        <a href="smokecontrol.html">Smoke Control</a>
        <a href="essentialservices.html">Essential Services</a>
      </div>
    </div>
    <div class="tab has-dropdown">
      <span>Documentation</span>
      <div class="dropdown-content">
        <a href="loadschedule.html">Load Schedule</a>
        <a href="cableschedule.html">Cable Schedule</a>
        <a href="designcert.html">Design Certificate</a>
        <a href="tcommissioning.html">T&C Checklists</a>
        <a href="inspection.html">Site Inspection</a>
        <a href="sld.html">Single Line Diagram</a>
        <a href="as3000tips.html">AS3000 Tips</a>
        <a href="as3000viewer.html">AS3000 Viewer</a>
      </div>
    </div>
    <a class="tab" href="qa.html">Verification</a>
  </div>

  <div class="main-content">
    <h1>Diversity Factor Calculator</h1>
    <p>Interactive diversity factor lookup and calculator per <strong>AS/NZS 3000:2018 Appendix C</strong> (Tables C1–C9). Select a building type to view applicable factors and calculate diversified demand.</p>

    <div class="sub-tabs">
      <button class="sub-tab active" onclick="showTab('lookup')">Factor Lookup</button>
      <button class="sub-tab" onclick="showTab('calc')">Quick Calculator</button>
      <button class="sub-tab" onclick="showTab('ref')">Full Reference Tables</button>
    </div>

    <div id="panel-lookup" class="tab-panel active">
      <div class="calc-section">
        <h2>Diversity Factor Lookup by Building Type</h2>
        <div class="input-row">
          <div class="input-group">
            <label for="buildingType">Building / Installation Type</label>
            <select id="buildingType" onchange="showFactors()">
              <option value="domestic_single">Domestic — Single Dwelling (Table C1 Col 2)</option>
              <option value="domestic_multi">Domestic — Block of Units (Table C1 Cols 3–5)</option>
              <option value="commercial">Commercial — Offices, Retail (Table C2)</option>
              <option value="industrial">Industrial / Warehouse (Table C2)</option>
              <option value="hospital">Hospital / Aged Care</option>
              <option value="school">School / Education</option>
              <option value="hotel">Hotel / Accommodation</option>
              <option value="va_method">VA per m² Method (Table C3)</option>
            </select>
          </div>
          <div class="input-group">
            <label for="voltage">Supply Voltage (V)</label>
            <input type="number" id="voltage" value="230" />
          </div>
        </div>
        <div id="factorDisplay"></div>
      </div>
    </div>

    <div id="panel-calc" class="tab-panel">
      <div class="calc-section">
        <h2>Diversified Demand Quick Calculator</h2>
        <div class="info-box">
          Enter the connected loads and number of units/instances. The tool applies AS/NZS 3000 Appendix C diversity factors automatically.
        </div>
        <div class="input-row">
          <div class="input-group">
            <label for="calcType">Calculation Type</label>
            <select id="calcType" onchange="updateCalcForm()">
              <option value="multi_dwelling">Multiple Dwelling Units (Table C1 Cols 3–5)</option>
              <option value="mixed_load">Mixed Load with Manual Diversity</option>
            </select>
          </div>
          <div class="input-group">
            <label for="numUnits">Number of Dwelling Units</label>
            <input type="number" id="numUnits" value="20" min="1" />
          </div>
        </div>
        <div id="multiDwellingCalc">
          <div class="input-row three">
            <div class="input-group">
              <label for="loadPerUnit">Load per Unit (A per phase)</label>
              <input type="number" id="loadPerUnit" value="40" min="1" step="1" />
              <span style="font-size:0.8em;color:#888;">Single dwelling max demand from Table C1 Col 2</span>
            </div>
            <div class="input-group">
              <label for="commonArea">Common Area Load (A)</label>
              <input type="number" id="commonArea" value="20" min="0" step="1" />
            </div>
            <div class="input-group">
              <label for="centralHW">Central Hot Water / HVAC (A)</label>
              <input type="number" id="centralHW" value="0" min="0" step="1" />
            </div>
          </div>
          <button class="calc-button" onclick="calcMultiDwelling()">Calculate Diversified Demand</button>
          <div id="multiResult" style="display:none;"></div>
        </div>
      </div>
    </div>

    <div id="panel-ref" class="tab-panel">
      <div class="calc-section">
        <h2>AS/NZS 3000 Appendix C — Diversity Factor Reference</h2>

        <h3>Table C1 — Multiple Dwelling Diversity (Columns 3–5)</h3>
        <div class="diversity-ref">
          <strong>AS/NZS 3000:2018 Table C1 Columns 3–5:</strong> Demand per unit decreases as the number of units increases due to statistical diversity.
        </div>
        <table class="ref-table">
          <thead><tr><th>No. of Units</th><th>Column 3 Factor</th><th>Column 4 Factor</th><th>Column 5 Factor</th></tr></thead>
          <tbody id="c1RefBody"></tbody>
        </table>

        <h3>Table C3 — VA per m² by Occupancy Type</h3>
        <table class="ref-table">
          <thead><tr><th>Occupancy Type</th><th>VA/m² (Lighting)</th><th>VA/m² (Power)</th><th>Diversity</th><th>Standard Ref</th></tr></thead>
          <tbody>
            <tr><td>Office — General</td><td>25–30</td><td>15–25</td><td>0.7–0.8</td><td>Table C3</td></tr>
            <tr><td>Office — High Density IT</td><td>25–30</td><td>40–60</td><td>0.6–0.7</td><td>Table C3</td></tr>
            <tr><td>Retail — Shopping Centre</td><td>25–35</td><td>10–20</td><td>0.8–0.9</td><td>Table C3</td></tr>
            <tr><td>Warehouse</td><td>10–15</td><td>5–10</td><td>0.6–0.7</td><td>Table C3</td></tr>
            <tr><td>Hospital — General</td><td>20–30</td><td>30–50</td><td>0.5–0.7</td><td>Table C3</td></tr>
            <tr><td>School</td><td>20–25</td><td>10–15</td><td>0.6–0.8</td><td>Table C3</td></tr>
            <tr><td>Hotel / Motel</td><td>15–25</td><td>10–20</td><td>0.5–0.6</td><td>Table C3</td></tr>
            <tr><td>Car Park</td><td>5–10</td><td>3–5</td><td>0.8–1.0</td><td>Table C3</td></tr>
            <tr><td>Apartment Common Areas</td><td>10–15</td><td>5–10</td><td>0.7–0.9</td><td>Table C3</td></tr>
          </tbody>
        </table>

        <h3>Table C7/C8 — Motor Diversity</h3>
        <table class="ref-table">
          <thead><tr><th>No. of Motors</th><th>Diversity Factor</th></tr></thead>
          <tbody>
            <tr><td>1</td><td>1.00</td></tr>
            <tr><td>2</td><td>0.90</td></tr>
            <tr><td>3</td><td>0.85</td></tr>
            <tr><td>4</td><td>0.80</td></tr>
            <tr><td>5</td><td>0.78</td></tr>
            <tr><td>6–10</td><td>0.70</td></tr>
            <tr><td>11–20</td><td>0.65</td></tr>
            <tr><td>21–50</td><td>0.60</td></tr>
            <tr><td>&gt;50</td><td>0.55</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Tab switching
    function showTab(name) {
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('panel-' + name).classList.add('active');
      event.target.classList.add('active');
    }

    // Multi-dwelling diversity factors (approximate from AS/NZS 3000 Table C1)
    // Column 3: lighting+SO, Column 4: cooking, Column 5: hot water
    const dwellingFactors = {
      1: [1.00, 1.00, 1.00], 2: [0.88, 0.78, 0.80], 3: [0.80, 0.65, 0.70],
      4: [0.74, 0.57, 0.63], 5: [0.70, 0.52, 0.58], 6: [0.66, 0.48, 0.55],
      8: [0.62, 0.43, 0.50], 10: [0.58, 0.40, 0.46], 12: [0.55, 0.38, 0.44],
      15: [0.52, 0.36, 0.41], 20: [0.48, 0.33, 0.38], 25: [0.45, 0.31, 0.36],
      30: [0.43, 0.30, 0.34], 40: [0.40, 0.28, 0.32], 50: [0.38, 0.27, 0.30],
      60: [0.37, 0.26, 0.29], 80: [0.35, 0.25, 0.28], 100: [0.34, 0.24, 0.27],
      150: [0.32, 0.23, 0.26], 200: [0.31, 0.22, 0.25]
    };

    function getDwellingFactor(n) {
      const keys = Object.keys(dwellingFactors).map(Number).sort((a,b) => a - b);
      if (n <= keys[0]) return dwellingFactors[keys[0]];
      if (n >= keys[keys.length - 1]) return dwellingFactors[keys[keys.length - 1]];
      let lower = keys[0], upper = keys[keys.length - 1];
      for (let i = 0; i < keys.length - 1; i++) {
        if (n >= keys[i] && n <= keys[i + 1]) { lower = keys[i]; upper = keys[i + 1]; break; }
      }
      const fl = dwellingFactors[lower];
      const fu = dwellingFactors[upper];
      const ratio = (n - lower) / (upper - lower);
      return [0, 1, 2].map(i => fl[i] + (fu[i] - fl[i]) * ratio);
    }

    function showFactors() {
      const type = document.getElementById('buildingType').value;
      const container = document.getElementById('factorDisplay');
      let html = '';

      if (type === 'domestic_single') {
        html = `<div class="diversity-ref"><strong>Table C1 Column 2 — Single Dwelling:</strong> No diversity applied to individual dwelling. Full connected load is assessed per the table rules (lighting points, socket-outlets, cooking, etc.).</div>
        <table class="ref-table"><thead><tr><th>Load Type</th><th>Rule</th><th>Typical Diversity</th></tr></thead><tbody>
        <tr><td>Lighting (a)(i)</td><td>3 A first 20 points + 2 A per additional 20</td><td>~50%</td></tr>
        <tr><td>Socket-outlets ≤10 A (b)(i)</td><td>10 A first 20 + 5 A per additional 20</td><td>~30–40%</td></tr>
        <tr><td>15 A socket-outlet (b)(ii)</td><td>+10 A each</td><td>100%</td></tr>
        <tr><td>Cooking >10 A (c)</td><td>50% connected load</td><td>50%</td></tr>
        <tr><td>A/C, water heater (d)(e)</td><td>100% largest + 50% rest within group (75%)</td><td>75%</td></tr>
        <tr><td>Permanently connected (f)</td><td>100% largest + 75% remainder</td><td>75%</td></tr>
        </tbody></table>`;
      } else if (type === 'domestic_multi') {
        html = `<div class="diversity-ref"><strong>Table C1 Columns 3–5:</strong> For blocks of living units, diversity is applied to the total demand across all units. Factors decrease as the number of units increases.</div>`;
        html += `<table class="ref-table"><thead><tr><th>No. of Units</th><th>Col 3 (Light+SO)</th><th>Col 4 (Cooking)</th><th>Col 5 (HW/AC)</th></tr></thead><tbody>`;
        [1,2,3,5,10,15,20,30,50,100].forEach(n => {
          const f = getDwellingFactor(n);
          html += `<tr><td>${n}</td><td>${f[0].toFixed(2)}</td><td>${f[1].toFixed(2)}</td><td>${f[2].toFixed(2)}</td></tr>`;
        });
        html += `</tbody></table>`;
      } else if (type === 'va_method') {
        html = `<div class="diversity-ref"><strong>Table C3 — VA/m² Method:</strong> Used for commercial/industrial buildings where load is estimated from floor area. Apply appropriate diversity factor to the total connected load.</div>
        <table class="ref-table"><thead><tr><th>Building Type</th><th>Lighting VA/m²</th><th>Power VA/m²</th><th>Diversity</th></tr></thead><tbody>
        <tr><td>Office</td><td>25–30</td><td>15–25</td><td>0.7–0.8</td></tr>
        <tr><td>Retail</td><td>25–35</td><td>10–20</td><td>0.8–0.9</td></tr>
        <tr><td>Warehouse</td><td>10–15</td><td>5–10</td><td>0.6–0.7</td></tr>
        <tr><td>Hospital</td><td>20–30</td><td>30–50</td><td>0.5–0.7</td></tr>
        <tr><td>School</td><td>20–25</td><td>10–15</td><td>0.6–0.8</td></tr>
        </tbody></table>`;
      } else {
        const typeData = {
          commercial: { name: 'Commercial (Office/Retail)', df: '0.7–0.8', notes: 'Apply to total connected load. Exclude HVAC (use mechanical engineer data). Table C2/C3.' },
          industrial: { name: 'Industrial / Warehouse', df: '0.5–0.7', notes: 'Motor diversity per Table C7/C8. Exclude process loads assessed separately.' },
          hospital: { name: 'Hospital / Aged Care', df: '0.5–0.7', notes: 'Higher base load. Essential services at 100%. Non-essential areas diversified.' },
          school: { name: 'School / Education', df: '0.6–0.8', notes: 'Seasonal variation. Apply to lighting and GPO loads.' },
          hotel: { name: 'Hotel / Accommodation', df: '0.5–0.6', notes: 'Per-room demand typically 3–5 kVA. Apply dwelling-style diversity for room count.' }
        };
        const d = typeData[type];
        html = `<div class="diversity-ref"><strong>${d.name}:</strong> Typical diversity factor range: <strong>${d.df}</strong>. ${d.notes}</div>`;
      }
      container.innerHTML = html;
    }

    function calcMultiDwelling() {
      const n = parseInt(document.getElementById('numUnits').value);
      const loadPerUnit = parseFloat(document.getElementById('loadPerUnit').value);
      const commonArea = parseFloat(document.getElementById('commonArea').value);
      const centralHW = parseFloat(document.getElementById('centralHW').value);
      const f = getDwellingFactor(n);
      const avgFactor = (f[0] + f[1] + f[2]) / 3;
      const diversifiedUnit = loadPerUnit * avgFactor;
      const totalDiversified = diversifiedUnit * n + commonArea + centralHW;
      const totalUndiversified = loadPerUnit * n + commonArea + centralHW;

      const div = document.getElementById('multiResult');
      div.style.display = 'block';
      div.innerHTML = `
        <div class="result-box">
          <h3>Diversified Maximum Demand — ${n} Dwelling Units</h3>
          <div class="result-grid">
            <div class="result-item">
              <div class="result-label">Undiversified Total (A)</div>
              <div class="result-value">${totalUndiversified.toFixed(0)}</div>
            </div>
            <div class="result-item">
              <div class="result-label">Average Diversity Factor</div>
              <div class="result-value">${avgFactor.toFixed(3)}</div>
            </div>
            <div class="result-item">
              <div class="result-label">Diversified Total (A)</div>
              <div class="result-value">${totalDiversified.toFixed(0)}</div>
            </div>
            <div class="result-item">
              <div class="result-label">Demand Reduction</div>
              <div class="result-value">${((1 - totalDiversified / totalUndiversified) * 100).toFixed(0)}%</div>
            </div>
          </div>
        </div>
        <div class="info-box" style="margin-top:16px;">
          <strong>Breakdown:</strong> ${n} units × ${loadPerUnit} A × ${avgFactor.toFixed(3)} = ${(diversifiedUnit * n).toFixed(0)} A (units) + ${commonArea} A (common) + ${centralHW} A (central services) = <strong>${totalDiversified.toFixed(0)} A per phase</strong>.
          <br>Factors used: Col 3 = ${f[0].toFixed(3)}, Col 4 = ${f[1].toFixed(3)}, Col 5 = ${f[2].toFixed(3)} per AS/NZS 3000 Table C1.
        </div>
      `;
    }

    function updateCalcForm() { /* Future: toggle between multi-dwelling and mixed */ }

    // Build C1 reference table on load
    (function() {
      const body = document.getElementById('c1RefBody');
      [1,2,3,4,5,6,8,10,12,15,20,25,30,40,50,60,80,100,150,200].forEach(n => {
        const f = getDwellingFactor(n);
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${n}</td><td>${f[0].toFixed(3)}</td><td>${f[1].toFixed(3)}</td><td>${f[2].toFixed(3)}</td>`;
        body.appendChild(tr);
      });
    })();

    // Show initial factors
    showFactors();
  </script>
</body>
</html>
